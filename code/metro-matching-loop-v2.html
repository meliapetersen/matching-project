<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>metro-matching-loop</title>

<script src="metro-matching-loop-v2_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="metro-matching-loop-v2_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="metro-matching-loop-v2_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="metro-matching-loop-v2_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="metro-matching-loop-v2_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="metro-matching-loop-v2_files/navigation-1.1/tabsets.js"></script>
<script src="metro-matching-loop-v2_files/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="metro-matching-loop-v2_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="metro-matching-loop-v2_files/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">metro-matching-loop</h1>
<h4 class="date">25 September, 2020</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#step-01">STEP 01</a></li>
<li><a href="#step-02">STEP 02</a></li>
<li><a href="#step-03">STEP 03</a></li>
<li><a href="#step-04">STEP 04</a><ul>
<li><a href="#assign-tracts-to-groups">Assign tracts to groups</a></li>
</ul></li>
<li><a href="#step-05---map-matches">STEP 05 - Map Matches</a></li>
<li><a href="#combine-steps">Combine Steps</a><ul>
<li><a href="#create-loop-for-all-cbsas">Create loop for all CBSAs</a></li>
</ul></li>
</ul>
</div>

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># need this installed to use</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># genetic matching option in MatchIt</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># install.packages(&quot;rgenoud&quot;)</span></span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># load package </span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>( MatchIt )</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">library</span>( here )</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">library</span>( dplyr )</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">library</span>( geojsonio )</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">library</span>( sp )</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="kw">library</span>( pander )</span></code></pre></div>
<div id="step-01" class="section level2">
<h2>STEP 01</h2>
<p>Load a catalog of URLs of dorling cartograms for each CBSA metro area in the US.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>load_crosswalk &lt;-<span class="st"> </span><span class="cf">function</span>( )</span>
<span id="cb2-2"><a href="#cb2-2"></a>{</span>
<span id="cb2-3"><a href="#cb2-3"></a>   dorlings.url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/meliapetersen/matching-project/master/data/cbsa-names-and-shapefiles.csv&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>   dorlings.catalog &lt;-<span class="st"> </span><span class="kw">read.csv</span>( dorlings.url )</span>
<span id="cb2-5"><a href="#cb2-5"></a>   <span class="kw">return</span>( dorlings.catalog )</span>
<span id="cb2-6"><a href="#cb2-6"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>dorlings.catalog &lt;-<span class="st"> </span><span class="kw">load_crosswalk</span>()</span>
<span id="cb3-2"><a href="#cb3-2"></a>rmarkdown<span class="op">::</span><span class="kw">paged_table</span>( <span class="kw">head</span>( dorlings.catalog ) )</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["cbsaname"],"name":[1],"type":["chr"],"align":["left"]},{"label":["cbsa"],"name":[2],"type":["int"],"align":["right"]},{"label":["shapefile"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Abilene, TX","2":"10180","3":"abilene-tx-dorling-v2.geojson","_rn_":"1"},{"1":"Akron, OH","2":"10420","3":"akron-oh-dorling-v2.geojson","_rn_":"2"},{"1":"Albany, GA","2":"10500","3":"albany-ga-dorling-v2.geojson","_rn_":"3"},{"1":"Albany-Schenectady-Troy, NY","2":"10580","3":"albany-schenectady-troy-ny-dorling-v2.geojson","_rn_":"4"},{"1":"Albuquerque, NM","2":"10740","3":"albuquerque-nm-dorling-v2.geojson","_rn_":"5"},{"1":"Alexandria, LA","2":"10780","3":"alexandria-la-dorling-v2.geojson","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Load a dorling cartogram for one metro area:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>get_dorling &lt;-<span class="st"> </span><span class="cf">function</span>( cbsa, <span class="dt">dorlings.catalog=</span><span class="ot">NULL</span>, <span class="dt">mapit=</span><span class="ot">FALSE</span> )</span>
<span id="cb4-2"><a href="#cb4-2"></a>{</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a>   <span class="cf">if</span>( <span class="kw">is.null</span>(dorlings.catalog) ){ dorlings.catalog &lt;-<span class="st"> </span><span class="kw">load_crosswalk</span>() }</span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a>   file.name &lt;-<span class="st"> </span>dorlings.catalog<span class="op">$</span>shapefile[ dorlings.catalog<span class="op">$</span>cbsa <span class="op">==</span><span class="st"> </span>cbsa ]</span>
<span id="cb4-8"><a href="#cb4-8"></a> </span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a>   base.url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/DS4PS/usa-dorling-shapefiles/master/maps/metros-dorling/&quot;</span></span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a>   full.url &lt;-<span class="st"> </span><span class="kw">paste0</span>( base.url, file.name )</span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a>   map &lt;-<span class="st"> </span>geojsonio<span class="op">::</span><span class="kw">geojson_read</span>( <span class="dt">x=</span>full.url,  <span class="dt">what=</span><span class="st">&quot;sp&quot;</span> )</span>
<span id="cb4-15"><a href="#cb4-15"></a></span>
<span id="cb4-16"><a href="#cb4-16"></a>   <span class="cf">if</span>( mapit ){ <span class="kw">plot</span>( map ) }</span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a>   <span class="kw">return</span>( map )</span>
<span id="cb4-19"><a href="#cb4-19"></a>   </span>
<span id="cb4-20"><a href="#cb4-20"></a>}</span></code></pre></div>
<p>Test the function with New Orleans data:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>new.orleans.cbsa.code &lt;-<span class="st"> </span><span class="dv">10580</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>new.orleans &lt;-<span class="st"> </span><span class="kw">get_dorling</span>( <span class="dt">cbsa=</span>new.orleans.cbsa.code )</span></code></pre></div>
</div>
<div id="step-02" class="section level2">
<h2>STEP 02</h2>
<p>Load the treatment data:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>df.treatment &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;rodeod-treatment-data.csv&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a>rmarkdown<span class="op">::</span><span class="kw">paged_table</span>(  <span class="kw">head</span>(df.treatment) )</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["X"],"name":[1],"type":["int"],"align":["right"]},{"label":["cbsa"],"name":[2],"type":["int"],"align":["right"]},{"label":["id2"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["treatment"],"name":[4],"type":["int"],"align":["right"]},{"label":["pop00.x"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["nhwht00"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["nhblk00"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["ntv00"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["asian00"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["hisp00"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["haw00"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["india00"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["china00"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["filip00"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["japan00"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["korea00"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["viet00"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["mex00"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["pr00"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["cuban00"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["hu00"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["vac00"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["ohu00"],"name":[23],"type":["dbl"],"align":["right"]},{"label":["a18und00"],"name":[24],"type":["dbl"],"align":["right"]},{"label":["a60up00"],"name":[25],"type":["dbl"],"align":["right"]},{"label":["a75up00"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["agewht00"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["a15wht00"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["a60wht00"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["ageblk00"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["a15blk00"],"name":[31],"type":["dbl"],"align":["right"]},{"label":["a60blk00"],"name":[32],"type":["dbl"],"align":["right"]},{"label":["agehsp00"],"name":[33],"type":["dbl"],"align":["right"]},{"label":["a15hsp00"],"name":[34],"type":["dbl"],"align":["right"]},{"label":["a60hsp00"],"name":[35],"type":["dbl"],"align":["right"]},{"label":["agentv00"],"name":[36],"type":["dbl"],"align":["right"]},{"label":["a15ntv00"],"name":[37],"type":["dbl"],"align":["right"]},{"label":["a60ntv00"],"name":[38],"type":["dbl"],"align":["right"]},{"label":["ageasn00"],"name":[39],"type":["dbl"],"align":["right"]},{"label":["a15asn00"],"name":[40],"type":["dbl"],"align":["right"]},{"label":["a60asn00"],"name":[41],"type":["dbl"],"align":["right"]},{"label":["family00"],"name":[42],"type":["dbl"],"align":["right"]},{"label":["fhh00"],"name":[43],"type":["dbl"],"align":["right"]},{"label":["own00"],"name":[44],"type":["dbl"],"align":["right"]},{"label":["rent00"],"name":[45],"type":["dbl"],"align":["right"]},{"label":["pop00.y"],"name":[46],"type":["dbl"],"align":["right"]},{"label":["ruanc00"],"name":[47],"type":["dbl"],"align":["right"]},{"label":["itanc00"],"name":[48],"type":["dbl"],"align":["right"]},{"label":["geanc00"],"name":[49],"type":["dbl"],"align":["right"]},{"label":["iranc00"],"name":[50],"type":["dbl"],"align":["right"]},{"label":["scanc00"],"name":[51],"type":["dbl"],"align":["right"]},{"label":["rufb00"],"name":[52],"type":["dbl"],"align":["right"]},{"label":["itfb00"],"name":[53],"type":["dbl"],"align":["right"]},{"label":["gefb00"],"name":[54],"type":["dbl"],"align":["right"]},{"label":["irfb00"],"name":[55],"type":["dbl"],"align":["right"]},{"label":["scfb00"],"name":[56],"type":["dbl"],"align":["right"]},{"label":["fb00"],"name":[57],"type":["dbl"],"align":["right"]},{"label":["nat00"],"name":[58],"type":["dbl"],"align":["right"]},{"label":["n10imm00"],"name":[59],"type":["dbl"],"align":["right"]},{"label":["ag5up00"],"name":[60],"type":["dbl"],"align":["right"]},{"label":["olang00"],"name":[61],"type":["dbl"],"align":["right"]},{"label":["lep00"],"name":[62],"type":["dbl"],"align":["right"]},{"label":["ag25up00"],"name":[63],"type":["dbl"],"align":["right"]},{"label":["hs00"],"name":[64],"type":["dbl"],"align":["right"]},{"label":["col00"],"name":[65],"type":["dbl"],"align":["right"]},{"label":["ag15up00"],"name":[66],"type":["dbl"],"align":["right"]},{"label":["mar00"],"name":[67],"type":["dbl"],"align":["right"]},{"label":["wds00"],"name":[68],"type":["dbl"],"align":["right"]},{"label":["clf00"],"name":[69],"type":["dbl"],"align":["right"]},{"label":["unemp00"],"name":[70],"type":["dbl"],"align":["right"]},{"label":["dflabf00"],"name":[71],"type":["dbl"],"align":["right"]},{"label":["flabf00"],"name":[72],"type":["dbl"],"align":["right"]},{"label":["empclf00"],"name":[73],"type":["dbl"],"align":["right"]},{"label":["prof00"],"name":[74],"type":["dbl"],"align":["right"]},{"label":["manuf00"],"name":[75],"type":["dbl"],"align":["right"]},{"label":["semp00"],"name":[76],"type":["dbl"],"align":["right"]},{"label":["ag18cv00"],"name":[77],"type":["dbl"],"align":["right"]},{"label":["vet00"],"name":[78],"type":["dbl"],"align":["right"]},{"label":["cni16u00"],"name":[79],"type":["dbl"],"align":["right"]},{"label":["dis00"],"name":[80],"type":["dbl"],"align":["right"]},{"label":["dpov00"],"name":[81],"type":["dbl"],"align":["right"]},{"label":["npov00"],"name":[82],"type":["dbl"],"align":["right"]},{"label":["n65pov00"],"name":[83],"type":["dbl"],"align":["right"]},{"label":["dfmpov00"],"name":[84],"type":["dbl"],"align":["right"]},{"label":["nfmpov00"],"name":[85],"type":["dbl"],"align":["right"]},{"label":["dwpov00"],"name":[86],"type":["dbl"],"align":["right"]},{"label":["nwpov00"],"name":[87],"type":["dbl"],"align":["right"]},{"label":["dbpov00"],"name":[88],"type":["dbl"],"align":["right"]},{"label":["nbpov00"],"name":[89],"type":["dbl"],"align":["right"]},{"label":["dnapov00"],"name":[90],"type":["dbl"],"align":["right"]},{"label":["nnapov00"],"name":[91],"type":["dbl"],"align":["right"]},{"label":["dhpov00"],"name":[92],"type":["dbl"],"align":["right"]},{"label":["nhpov00"],"name":[93],"type":["dbl"],"align":["right"]},{"label":["dapov00"],"name":[94],"type":["dbl"],"align":["right"]},{"label":["napov00"],"name":[95],"type":["dbl"],"align":["right"]},{"label":["incpc00"],"name":[96],"type":["dbl"],"align":["right"]},{"label":["hu00sp"],"name":[97],"type":["dbl"],"align":["right"]},{"label":["h30old00"],"name":[98],"type":["dbl"],"align":["right"]},{"label":["ohu00sp"],"name":[99],"type":["dbl"],"align":["right"]},{"label":["h10yrs00"],"name":[100],"type":["dbl"],"align":["right"]},{"label":["dmulti00"],"name":[101],"type":["dbl"],"align":["right"]},{"label":["multi00"],"name":[102],"type":["dbl"],"align":["right"]},{"label":["hinc00"],"name":[103],"type":["dbl"],"align":["right"]},{"label":["hincw00"],"name":[104],"type":["dbl"],"align":["right"]},{"label":["hincb00"],"name":[105],"type":["dbl"],"align":["right"]},{"label":["hinch00"],"name":[106],"type":["dbl"],"align":["right"]},{"label":["hinca00"],"name":[107],"type":["dbl"],"align":["right"]},{"label":["mhmval00"],"name":[108],"type":["dbl"],"align":["right"]},{"label":["mrent00"],"name":[109],"type":["dbl"],"align":["right"]},{"label":["hh00"],"name":[110],"type":["dbl"],"align":["right"]},{"label":["hhw00"],"name":[111],"type":["dbl"],"align":["right"]},{"label":["hhb00"],"name":[112],"type":["dbl"],"align":["right"]},{"label":["hhh00"],"name":[113],"type":["dbl"],"align":["right"]},{"label":["hha00"],"name":[114],"type":["dbl"],"align":["right"]},{"label":["Treated"],"name":[115],"type":["int"],"align":["right"]},{"label":["Control"],"name":[116],"type":["int"],"align":["right"]}],"data":[{"1":"1","2":"33860","3":"1001020100","4":"0","5":"1920.975","6":"1722.977","7":"144.9981","8":"28.99962","9":"7.999895","10":"11.99984","11":"0.0000000","12":"3.9999473","13":"0.00000","14":"0.9999868","15":"0.9999868","16":"1.999974","17":"0.0000000","18":"3.999947","19":"1.999974","20":"0.000000","21":"768.9899","22":"92.99877","23":"675.9911","24":"518.9932","25":"259.9966","26":"68.99909","27":"1722.977","28":"402.9947","29":"244.9968","30":"140.9981","31":"30.99959","32":"12.999828","33":"11.99984","34":"3.999947","35":"0.9999868","36":"14.99980","37":"4.999934","38":"0.000000000","39":"6.999908","40":"1.999974","41":"0.9999868","42":"531.9930","43":"58.99922","44":"517.9932","45":"157.9979","46":"1878.975","47":"0","48":"4.999934","49":"138.9982","50":"165.9978","51":"5.999921","52":"0","53":"0","54":"0.000000","55":"0","56":"0","57":"0.00000","58":"0.00000","59":"0.000000","60":"1780.977","61":"37.9995","62":"0.00000","63":"1226.984","64":"634.9916","65":"191.9975","66":"1468.981","67":"960.9874","68":"236.9969","69":"871.9885","70":"45.99939","71":"751.9901","72":"383.9949","73":"825.9891","74":"220.9971","75":"73.99902","76":"67.99911","77":"1315.983","78":"239.9968","79":"1195.984","80":"275.9964","81":"1789.976","82":"226.9970","83":"10.99986","84":"550.9927","85":"46.99938","86":"1758.977","87":"211.9972","88":"30.99959","89":"14.99980","90":"0.00000","91":"0","92":"0.00000","93":"0","94":"0.000000","95":"0","96":"17771.00","97":"741.9902","98":"224.9970","99":"659.9913","100":"443.9941","101":"741.9902","102":"18.99975","103":"36685.00","104":"36957.00","105":"23438.00","106":"44199.63","107":"59227.880","108":"76600.0","109":"339.000","110":"716.9905","111":"703.9907","112":"12.99983","113":"0.00000","114":"0.000000","115":"0","116":"1","_rn_":"1"},{"1":"2","2":"33860","3":"1001020200","4":"0","5":"1892.000","6":"671.000","7":"1177.0000","8":"12.00000","9":"12.000000","10":"16.00000","11":"0.0000000","12":"0.0000000","13":"1.00000","14":"3.0000000","15":"1.0000000","16":"6.000000","17":"0.0000000","18":"11.000000","19":"1.000000","20":"3.000000","21":"731.0000","22":"67.00000","23":"664.0000","24":"530.0000","25":"282.0000","26":"103.00000","27":"671.000","28":"156.0000","29":"120.0000","30":"1163.0000","31":"302.00000","32":"158.000000","33":"16.00000","34":"5.000000","35":"1.0000000","36":"6.00000","37":"0.000000","38":"0.000000000","39":"7.000000","40":"1.000000","41":"0.0000000","42":"494.0000","43":"121.00000","44":"452.0000","45":"212.0000","46":"1934.000","47":"0","48":"39.000000","49":"78.0000","50":"34.0000","51":"0.000000","52":"0","53":"0","54":"0.000000","55":"0","56":"0","57":"0.00000","58":"0.00000","59":"0.000000","60":"1774.000","61":"51.0000","62":"8.00000","63":"1157.000","64":"740.0000","65":"170.0000","66":"1479.000","67":"598.0000","68":"314.0000","69":"802.0000","70":"80.00000","71":"776.0000","72":"392.0000","73":"722.0000","74":"154.0000","75":"82.00000","76":"61.00000","77":"1398.000","78":"219.0000","79":"1195.000","80":"435.0000","81":"1907.000","82":"433.0000","83":"32.00000","84":"476.0000","85":"65.00000","86":"626.000","87":"53.0000","88":"1249.00000","89":"367.00000","90":"0.00000","91":"0","92":"0.00000","93":"0","94":"0.000000","95":"0","96":"14217.00","97":"758.0000","98":"329.0000","99":"680.0000","100":"311.0000","101":"758.0000","102":"36.00000","103":"30298.00","104":"40288.00","105":"27938.00","106":"44199.63","107":"59227.880","108":"72900.0","109":"260.000","110":"629.0000","111":"245.0000","112":"365.00000","113":"0.00000","114":"0.000000","115":"0","116":"1","_rn_":"2"},{"1":"3","2":"33860","3":"1001020300","4":"0","5":"3339.000","6":"2738.000","7":"498.0000","8":"16.00000","9":"27.000000","10":"55.00000","11":"1.0000000","12":"0.0000000","13":"3.00000","14":"3.0000000","15":"8.0000000","16":"2.000000","17":"1.0000000","18":"29.000000","19":"16.000000","20":"0.000000","21":"1263.0000","22":"61.00000","23":"1202.0000","24":"960.0000","25":"594.0000","26":"229.00000","27":"2738.000","28":"691.0000","29":"499.0000","30":"491.0000","31":"132.00000","32":"84.000000","33":"55.00000","34":"18.000000","35":"3.0000000","36":"7.00000","37":"2.000000","38":"0.000000000","39":"23.000000","40":"3.000000","41":"6.0000000","42":"920.0000","43":"118.00000","44":"869.0000","45":"333.0000","46":"3339.000","47":"0","48":"66.000000","49":"186.0000","50":"157.0000","51":"49.000000","52":"0","53":"0","54":"17.000000","55":"0","56":"7","57":"68.00000","58":"45.00000","59":"13.000000","60":"3047.000","61":"133.0000","62":"17.00000","63":"2130.000","64":"990.0000","65":"478.0000","66":"2503.000","67":"1438.0000","68":"577.0000","69":"1456.0000","70":"42.00000","71":"1318.0000","72":"677.0000","73":"1414.0000","74":"438.0000","75":"144.00000","76":"50.00000","77":"2284.000","78":"494.0000","79":"1907.000","80":"340.0000","81":"3262.000","82":"250.0000","83":"45.00000","84":"937.0000","85":"36.00000","86":"2669.000","87":"142.0000","88":"466.00000","89":"102.00000","90":"14.00000","91":"0","92":"93.00000","93":"6","94":"16.000000","95":"0","96":"18346.00","97":"1263.0000","98":"452.0000","99":"1202.0000","100":"897.0000","101":"1263.0000","102":"96.00000","103":"46731.00","104":"48977.00","105":"30163.00","106":"48611.00","107":"87500.000","108":"79900.0","109":"449.000","110":"1204.0000","111":"1003.0000","112":"169.00000","113":"22.00000","114":"6.000000","115":"0","116":"1","_rn_":"3"},{"1":"4","2":"33860","3":"1001020400","4":"0","5":"4556.000","6":"4273.000","7":"118.0000","8":"23.00000","9":"40.000000","10":"101.00000","11":"0.0000000","12":"6.0000000","13":"5.00000","14":"7.0000000","15":"13.0000000","16":"8.000000","17":"4.0000000","18":"43.000000","19":"32.000000","20":"0.000000","21":"1871.0000","22":"111.00000","23":"1760.0000","24":"1123.0000","25":"1009.0000","26":"244.00000","27":"4273.000","28":"911.0000","29":"982.0000","30":"117.0000","31":"39.00000","32":"6.000000","33":"101.00000","34":"29.000000","35":"12.0000000","36":"10.00000","37":"0.000000","38":"3.000000000","39":"32.000000","40":"4.000000","41":"5.0000000","42":"1376.0000","43":"102.00000","44":"1390.0000","45":"370.0000","46":"4556.000","47":"12","48":"59.000000","49":"355.0000","50":"302.0000","51":"17.000000","52":"0","53":"0","54":"11.000000","55":"9","56":"0","57":"66.00000","58":"46.00000","59":"13.000000","60":"4281.000","61":"132.0000","62":"0.00000","63":"3072.000","64":"1477.0000","65":"708.0000","66":"3635.000","67":"2402.0000","68":"542.0000","69":"2191.0000","70":"77.00000","71":"1839.0000","72":"1062.0000","73":"2114.0000","74":"673.0000","75":"277.00000","76":"250.00000","77":"3354.000","78":"730.0000","79":"2793.000","80":"452.0000","81":"4551.000","82":"207.0000","83":"45.00000","84":"1385.0000","85":"25.00000","86":"4268.000","87":"177.0000","88":"105.00000","89":"0.00000","90":"6.00000","91":"0","92":"63.00000","93":"30","94":"65.000000","95":"0","96":"19741.00","97":"1871.0000","98":"979.0000","99":"1760.0000","100":"1037.0000","101":"1871.0000","102":"77.00000","103":"46142.00","104":"46774.00","105":"18611.00","106":"80090.00","107":"112500.000","108":"89800.0","109":"494.000","110":"1750.0000","111":"1659.0000","112":"46.00000","113":"16.00000","114":"7.000000","115":"0","116":"1","_rn_":"4"},{"1":"5","2":"33860","3":"1001020500","4":"0","5":"6053.912","6":"5426.983","7":"367.4790","8":"36.10111","9":"113.055609","10":"95.23760","11":"0.0000000","12":"5.0000000","13":"17.01011","14":"21.0000000","15":"20.0000000","16":"31.015166","17":"10.0101107","18":"35.085941","19":"28.060664","20":"2.005055","21":"2282.3435","22":"80.39432","23":"2201.9492","24":"1871.2515","25":"653.5570","26":"156.43476","27":"5426.983","28":"1466.1586","29":"630.2082","30":"358.4639","31":"121.50649","32":"8.318486","33":"95.23760","34":"36.070775","35":"7.0101107","36":"25.07077","37":"8.010111","38":"0.005055337","39":"72.045498","40":"13.000000","41":"8.0101107","42":"1746.8977","43":"144.64203","44":"1670.6752","45":"531.2739","46":"6053.912","47":"10","48":"84.131439","49":"530.4954","50":"487.3337","51":"35.055609","52":"0","53":"0","54":"9.070775","55":"0","56":"0","57":"81.20221","58":"64.20221","59":"9.000000","60":"5601.028","61":"126.4449","62":"33.02528","63":"3785.215","64":"1257.3526","65":"1214.0920","66":"4446.374","67":"3155.0967","68":"608.6986","69":"2955.1685","70":"49.34882","71":"2272.4042","72":"1316.7966","73":"2905.8196","74":"1173.4964","75":"391.91502","76":"167.36398","77":"3997.393","78":"683.4559","79":"3788.518","80":"420.3852","81":"6047.882","82":"223.2739","83":"18.10616","84":"1746.8774","85":"45.24266","86":"5371.938","87":"141.3893","88":"400.40825","89":"34.88468","90":"31.12133","91":"0","92":"49.29826","93":"23","94":"88.090996","95":"24","96":"24492.37","97":"2282.3435","98":"152.4812","99":"2201.9492","100":"1784.2000","101":"2282.3435","102":"334.43981","103":"58886.27","104":"59322.24","105":"45502.24","106":"51289.29","107":"5112.719","108":"116593.5","109":"558.753","110":"2190.9391","111":"2037.3163","112":"125.44077","113":"14.06066","114":"5.045498","115":"0","116":"1","_rn_":"5"},{"1":"6","2":"33860","3":"1001020600","4":"0","5":"3272.000","6":"2615.275","7":"553.0823","8":"25.18413","9":"10.654825","10":"63.92895","11":"0.9686205","12":"0.9686205","13":"0.00000","14":"0.9686205","15":"1.9372410","16":"1.937241","17":"0.9686205","18":"21.309650","19":"8.717585","20":"0.000000","21":"1309.5748","22":"139.48135","23":"1170.0935","24":"992.8360","25":"430.0675","26":"116.23446","27":"2615.275","28":"677.0657","29":"356.4523","30":"540.4902","31":"176.28893","32":"65.866196","33":"63.92895","34":"14.529307","35":"4.8431025","36":"11.62345","37":"1.937241","38":"0.968620479","39":"6.780344","40":"1.937241","41":"0.9686205","42":"904.6915","43":"123.01480","44":"960.8715","45":"209.2220","46":"3272.000","47":"0","48":"57.148609","49":"145.2931","50":"167.5714","51":"2.905861","52":"0","53":"0","54":"10.654825","55":"0","56":"0","57":"30.02724","58":"10.65483","59":"5.811723","60":"3031.782","61":"142.3872","62":"56.17999","63":"1976.954","64":"1178.8112","65":"317.7075","66":"2382.806","67":"1336.6963","68":"553.0823","69":"1583.6945","70":"87.17584","71":"1246.6145","72":"747.7750","73":"1496.5187","74":"364.2013","75":"234.40616","76":"139.48135","77":"2261.729","78":"355.4837","79":"2004.076","80":"425.2244","81":"3272.000","82":"497.8709","83":"67.80344","84":"902.7543","85":"82.33274","86":"2592.028","87":"253.7786","88":"535.64709","89":"214.06512","90":"0.00000","91":"0","92":"30.02724","93":"0","94":"8.717585","95":"0","96":"16395.00","97":"1309.5748","98":"450.4085","99":"1170.0935","100":"696.4381","101":"1309.5748","102":"34.87034","103":"33699.00","104":"37727.00","105":"18819.00","106":"44199.63","107":"37499.999","108":"70400.0","109":"337.000","110":"1161.3760","111":"920.1895","112":"185.97513","113":"0.00000","114":"8.717585","115":"0","116":"1","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Add the treatment data to the dorling spatial object:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>add_treatment &lt;-<span class="st"> </span><span class="cf">function</span>( df.treatment, dorling.object )</span>
<span id="cb7-2"><a href="#cb7-2"></a>{</span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="co"># merge leftjoin</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  dorling.object &lt;-<span class="st"> </span><span class="kw">merge</span>( dorling.object, df.treatment, <span class="dt">by.x=</span><span class="st">&quot;GEOID&quot;</span>, <span class="dt">by.y=</span><span class="st">&quot;id2&quot;</span>, <span class="dt">all.x=</span><span class="ot">TRUE</span> )</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="co"># dorling.object &lt;- df2</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="co"># x &lt;- c( 1, NA, NA, 1, NA, NA )</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="co"># </span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="co"># omit NAs</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  treatment &lt;-<span class="st"> </span>dorling.object<span class="op">$</span>treatment </span>
<span id="cb7-13"><a href="#cb7-13"></a>  treatment[ <span class="kw">is.na</span>(treatment) ] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  dorling.object<span class="op">$</span>treatment &lt;-<span class="st"> </span>treatment</span>
<span id="cb7-15"><a href="#cb7-15"></a> </span>
<span id="cb7-16"><a href="#cb7-16"></a>  <span class="co"># row.names(df.rodeo.metro) &lt;- df.rodeo.metro$id2    </span></span>
<span id="cb7-17"><a href="#cb7-17"></a>  <span class="co"># df.rodeo.metro &lt;- na.omit( df.rodeo.metro )</span></span>
<span id="cb7-18"><a href="#cb7-18"></a></span>
<span id="cb7-19"><a href="#cb7-19"></a>  <span class="kw">return</span>( dorling.object )</span>
<span id="cb7-20"><a href="#cb7-20"></a>}</span></code></pre></div>
<p>Test the function:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>new.orleans &lt;-<span class="st"> </span><span class="kw">add_treatment</span>( df.treatment, <span class="dt">dorling.object=</span>new.orleans ) </span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co"># unit test - make sure data merge worked</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="kw">table</span>( new.orleans<span class="op">$</span>treatment, <span class="dt">useNA=</span><span class="st">&quot;ifany&quot;</span> )</span></code></pre></div>
<pre><code>## 
##   0   1 
## 207  11</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># appended data </span></span>
<span id="cb10-2"><a href="#cb10-2"></a>rmarkdown<span class="op">::</span><span class="kw">paged_table</span>( <span class="kw">head</span>(new.orleans<span class="op">@</span>data) )</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["GEOID"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["POP"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["state"],"name":[3],"type":["chr"],"align":["left"]},{"label":["county"],"name":[4],"type":["chr"],"align":["left"]},{"label":["tract"],"name":[5],"type":["chr"],"align":["left"]},{"label":["pop10"],"name":[6],"type":["int"],"align":["right"]},{"label":["nhwht10"],"name":[7],"type":["int"],"align":["right"]},{"label":["nhblk10"],"name":[8],"type":["int"],"align":["right"]},{"label":["ntv10"],"name":[9],"type":["int"],"align":["right"]},{"label":["asian10"],"name":[10],"type":["int"],"align":["right"]},{"label":["hisp10"],"name":[11],"type":["int"],"align":["right"]},{"label":["haw10"],"name":[12],"type":["int"],"align":["right"]},{"label":["india10"],"name":[13],"type":["int"],"align":["right"]},{"label":["china10"],"name":[14],"type":["int"],"align":["right"]},{"label":["filip10"],"name":[15],"type":["int"],"align":["right"]},{"label":["japan10"],"name":[16],"type":["int"],"align":["right"]},{"label":["korea10"],"name":[17],"type":["int"],"align":["right"]},{"label":["viet10"],"name":[18],"type":["int"],"align":["right"]},{"label":["mex10"],"name":[19],"type":["int"],"align":["right"]},{"label":["pr10"],"name":[20],"type":["int"],"align":["right"]},{"label":["cuban10"],"name":[21],"type":["int"],"align":["right"]},{"label":["family10"],"name":[22],"type":["int"],"align":["right"]},{"label":["fhh10"],"name":[23],"type":["int"],"align":["right"]},{"label":["hu10"],"name":[24],"type":["int"],"align":["right"]},{"label":["vac10"],"name":[25],"type":["int"],"align":["right"]},{"label":["ohu10"],"name":[26],"type":["int"],"align":["right"]},{"label":["own10"],"name":[27],"type":["int"],"align":["right"]},{"label":["rent10"],"name":[28],"type":["int"],"align":["right"]},{"label":["a18und10"],"name":[29],"type":["int"],"align":["right"]},{"label":["a60up10"],"name":[30],"type":["int"],"align":["right"]},{"label":["a75up10"],"name":[31],"type":["int"],"align":["right"]},{"label":["agewht10"],"name":[32],"type":["int"],"align":["right"]},{"label":["a15wht10"],"name":[33],"type":["int"],"align":["right"]},{"label":["a60wht10"],"name":[34],"type":["int"],"align":["right"]},{"label":["ageblk10"],"name":[35],"type":["int"],"align":["right"]},{"label":["a15blk10"],"name":[36],"type":["int"],"align":["right"]},{"label":["a60blk10"],"name":[37],"type":["int"],"align":["right"]},{"label":["agehsp10"],"name":[38],"type":["int"],"align":["right"]},{"label":["a15hsp10"],"name":[39],"type":["int"],"align":["right"]},{"label":["a60hsp10"],"name":[40],"type":["int"],"align":["right"]},{"label":["ageasn10"],"name":[41],"type":["int"],"align":["right"]},{"label":["a15asn10"],"name":[42],"type":["int"],"align":["right"]},{"label":["a60asn10"],"name":[43],"type":["int"],"align":["right"]},{"label":["agentv10"],"name":[44],"type":["int"],"align":["right"]},{"label":["a15ntv10"],"name":[45],"type":["int"],"align":["right"]},{"label":["a60ntv10"],"name":[46],"type":["int"],"align":["right"]},{"label":["GlobD10"],"name":[47],"type":["chr"],"align":["left"]},{"label":["GlobG10"],"name":[48],"type":["chr"],"align":["left"]},{"label":["pop.w"],"name":[49],"type":["dbl"],"align":["right"]},{"label":["X"],"name":[50],"type":["int"],"align":["right"]},{"label":["cbsa"],"name":[51],"type":["int"],"align":["right"]},{"label":["treatment"],"name":[52],"type":["dbl"],"align":["right"]},{"label":["pop00.x"],"name":[53],"type":["dbl"],"align":["right"]},{"label":["nhwht00"],"name":[54],"type":["dbl"],"align":["right"]},{"label":["nhblk00"],"name":[55],"type":["dbl"],"align":["right"]},{"label":["ntv00"],"name":[56],"type":["dbl"],"align":["right"]},{"label":["asian00"],"name":[57],"type":["dbl"],"align":["right"]},{"label":["hisp00"],"name":[58],"type":["dbl"],"align":["right"]},{"label":["haw00"],"name":[59],"type":["dbl"],"align":["right"]},{"label":["india00"],"name":[60],"type":["dbl"],"align":["right"]},{"label":["china00"],"name":[61],"type":["dbl"],"align":["right"]},{"label":["filip00"],"name":[62],"type":["dbl"],"align":["right"]},{"label":["japan00"],"name":[63],"type":["dbl"],"align":["right"]},{"label":["korea00"],"name":[64],"type":["dbl"],"align":["right"]},{"label":["viet00"],"name":[65],"type":["dbl"],"align":["right"]},{"label":["mex00"],"name":[66],"type":["dbl"],"align":["right"]},{"label":["pr00"],"name":[67],"type":["dbl"],"align":["right"]},{"label":["cuban00"],"name":[68],"type":["dbl"],"align":["right"]},{"label":["hu00"],"name":[69],"type":["dbl"],"align":["right"]},{"label":["vac00"],"name":[70],"type":["dbl"],"align":["right"]},{"label":["ohu00"],"name":[71],"type":["dbl"],"align":["right"]},{"label":["a18und00"],"name":[72],"type":["dbl"],"align":["right"]},{"label":["a60up00"],"name":[73],"type":["dbl"],"align":["right"]},{"label":["a75up00"],"name":[74],"type":["dbl"],"align":["right"]},{"label":["agewht00"],"name":[75],"type":["dbl"],"align":["right"]},{"label":["a15wht00"],"name":[76],"type":["dbl"],"align":["right"]},{"label":["a60wht00"],"name":[77],"type":["dbl"],"align":["right"]},{"label":["ageblk00"],"name":[78],"type":["dbl"],"align":["right"]},{"label":["a15blk00"],"name":[79],"type":["dbl"],"align":["right"]},{"label":["a60blk00"],"name":[80],"type":["dbl"],"align":["right"]},{"label":["agehsp00"],"name":[81],"type":["dbl"],"align":["right"]},{"label":["a15hsp00"],"name":[82],"type":["dbl"],"align":["right"]},{"label":["a60hsp00"],"name":[83],"type":["dbl"],"align":["right"]},{"label":["agentv00"],"name":[84],"type":["dbl"],"align":["right"]},{"label":["a15ntv00"],"name":[85],"type":["dbl"],"align":["right"]},{"label":["a60ntv00"],"name":[86],"type":["dbl"],"align":["right"]},{"label":["ageasn00"],"name":[87],"type":["dbl"],"align":["right"]},{"label":["a15asn00"],"name":[88],"type":["dbl"],"align":["right"]},{"label":["a60asn00"],"name":[89],"type":["dbl"],"align":["right"]},{"label":["family00"],"name":[90],"type":["dbl"],"align":["right"]},{"label":["fhh00"],"name":[91],"type":["dbl"],"align":["right"]},{"label":["own00"],"name":[92],"type":["dbl"],"align":["right"]},{"label":["rent00"],"name":[93],"type":["dbl"],"align":["right"]},{"label":["pop00.y"],"name":[94],"type":["dbl"],"align":["right"]},{"label":["ruanc00"],"name":[95],"type":["dbl"],"align":["right"]},{"label":["itanc00"],"name":[96],"type":["dbl"],"align":["right"]},{"label":["geanc00"],"name":[97],"type":["dbl"],"align":["right"]},{"label":["iranc00"],"name":[98],"type":["dbl"],"align":["right"]},{"label":["scanc00"],"name":[99],"type":["dbl"],"align":["right"]},{"label":["rufb00"],"name":[100],"type":["dbl"],"align":["right"]},{"label":["itfb00"],"name":[101],"type":["dbl"],"align":["right"]},{"label":["gefb00"],"name":[102],"type":["dbl"],"align":["right"]},{"label":["irfb00"],"name":[103],"type":["dbl"],"align":["right"]},{"label":["scfb00"],"name":[104],"type":["dbl"],"align":["right"]},{"label":["fb00"],"name":[105],"type":["dbl"],"align":["right"]},{"label":["nat00"],"name":[106],"type":["dbl"],"align":["right"]},{"label":["n10imm00"],"name":[107],"type":["dbl"],"align":["right"]},{"label":["ag5up00"],"name":[108],"type":["dbl"],"align":["right"]},{"label":["olang00"],"name":[109],"type":["dbl"],"align":["right"]},{"label":["lep00"],"name":[110],"type":["dbl"],"align":["right"]},{"label":["ag25up00"],"name":[111],"type":["dbl"],"align":["right"]},{"label":["hs00"],"name":[112],"type":["dbl"],"align":["right"]},{"label":["col00"],"name":[113],"type":["dbl"],"align":["right"]},{"label":["ag15up00"],"name":[114],"type":["dbl"],"align":["right"]},{"label":["mar00"],"name":[115],"type":["dbl"],"align":["right"]},{"label":["wds00"],"name":[116],"type":["dbl"],"align":["right"]},{"label":["clf00"],"name":[117],"type":["dbl"],"align":["right"]},{"label":["unemp00"],"name":[118],"type":["dbl"],"align":["right"]},{"label":["dflabf00"],"name":[119],"type":["dbl"],"align":["right"]},{"label":["flabf00"],"name":[120],"type":["dbl"],"align":["right"]},{"label":["empclf00"],"name":[121],"type":["dbl"],"align":["right"]},{"label":["prof00"],"name":[122],"type":["dbl"],"align":["right"]},{"label":["manuf00"],"name":[123],"type":["dbl"],"align":["right"]},{"label":["semp00"],"name":[124],"type":["dbl"],"align":["right"]},{"label":["ag18cv00"],"name":[125],"type":["dbl"],"align":["right"]},{"label":["vet00"],"name":[126],"type":["dbl"],"align":["right"]},{"label":["cni16u00"],"name":[127],"type":["dbl"],"align":["right"]},{"label":["dis00"],"name":[128],"type":["dbl"],"align":["right"]},{"label":["dpov00"],"name":[129],"type":["dbl"],"align":["right"]},{"label":["npov00"],"name":[130],"type":["dbl"],"align":["right"]},{"label":["n65pov00"],"name":[131],"type":["dbl"],"align":["right"]},{"label":["dfmpov00"],"name":[132],"type":["dbl"],"align":["right"]},{"label":["nfmpov00"],"name":[133],"type":["dbl"],"align":["right"]},{"label":["dwpov00"],"name":[134],"type":["dbl"],"align":["right"]},{"label":["nwpov00"],"name":[135],"type":["dbl"],"align":["right"]},{"label":["dbpov00"],"name":[136],"type":["dbl"],"align":["right"]},{"label":["nbpov00"],"name":[137],"type":["dbl"],"align":["right"]},{"label":["dnapov00"],"name":[138],"type":["dbl"],"align":["right"]},{"label":["nnapov00"],"name":[139],"type":["dbl"],"align":["right"]},{"label":["dhpov00"],"name":[140],"type":["dbl"],"align":["right"]},{"label":["nhpov00"],"name":[141],"type":["dbl"],"align":["right"]},{"label":["dapov00"],"name":[142],"type":["dbl"],"align":["right"]},{"label":["napov00"],"name":[143],"type":["dbl"],"align":["right"]},{"label":["incpc00"],"name":[144],"type":["dbl"],"align":["right"]},{"label":["hu00sp"],"name":[145],"type":["dbl"],"align":["right"]},{"label":["h30old00"],"name":[146],"type":["dbl"],"align":["right"]},{"label":["ohu00sp"],"name":[147],"type":["dbl"],"align":["right"]},{"label":["h10yrs00"],"name":[148],"type":["dbl"],"align":["right"]},{"label":["dmulti00"],"name":[149],"type":["dbl"],"align":["right"]},{"label":["multi00"],"name":[150],"type":["dbl"],"align":["right"]},{"label":["hinc00"],"name":[151],"type":["dbl"],"align":["right"]},{"label":["hincw00"],"name":[152],"type":["dbl"],"align":["right"]},{"label":["hincb00"],"name":[153],"type":["dbl"],"align":["right"]},{"label":["hinch00"],"name":[154],"type":["dbl"],"align":["right"]},{"label":["hinca00"],"name":[155],"type":["dbl"],"align":["right"]},{"label":["mhmval00"],"name":[156],"type":["dbl"],"align":["right"]},{"label":["mrent00"],"name":[157],"type":["dbl"],"align":["right"]},{"label":["hh00"],"name":[158],"type":["dbl"],"align":["right"]},{"label":["hhw00"],"name":[159],"type":["dbl"],"align":["right"]},{"label":["hhb00"],"name":[160],"type":["dbl"],"align":["right"]},{"label":["hhh00"],"name":[161],"type":["dbl"],"align":["right"]},{"label":["hha00"],"name":[162],"type":["dbl"],"align":["right"]},{"label":["Treated"],"name":[163],"type":["int"],"align":["right"]},{"label":["Control"],"name":[164],"type":["int"],"align":["right"]}],"data":[{"1":"3.6001e+10","2":"1939","3":"NY","4":"Albany County","5":"Census Tract 1","6":"2139","7":"466","8":"1400","9":"13","10":"58","11":"198","12":"0","13":"3","14":"11","15":"3","16":"8","17":"4","18":"41","19":"3","20":"121","21":"1","22":"527","23":"219","24":"910","25":"126","26":"784","27":"303","28":"481","29":"644","30":"294","31":"88","32":"466","33":"47","34":"133","35":"1343","36":"409","37":"138","38":"198","39":"70","40":"11","41":"55","42":"14","43":"11","44":"8","45":"1","46":"1","47":"wbha","48":"Global","49":"0.2552995","50":"35732","51":"10580","52":"1","53":"1729.840","54":"684.5171","55":"878.1799","56":"6.003759","57":"54.08316","58":"94.04980","59":"0.000000","60":"1.048863","61":"9.013625","62":"13.0042286","63":"1.000940","64":"3.006578","65":"30.005168","66":"2.004229","67":"66.02772","68":"0.000939681","69":"824.9759","70":"179.07846","71":"645.8974","72":"498.3397","73":"286.4741","74":"141.1983","75":"684.5171","76":"100.2265","77":"206.4365","78":"839.1630","79":"279.03477","80":"73.02349","81":"94.04980","82":"35.01222","83":"4.005168","84":"1.002349","85":"0.001409521","86":"0.000000000","87":"49.07893","88":"13.01644","89":"2.006578","90":"411.4567","91":"119.04276","92":"306.3552","93":"339.5422","94":"1740.840","95":"8.036178","96":"99.23539","97":"16.14847","98":"181.4092","99":"6.005638","100":"0.02396186","101":"4.005638","102":"4.00657777","103":"0.000000","104":"0","105":"144.1973","106":"104.1090","107":"67.115111","108":"1587.771","109":"144.2175","110":"15.01222","111":"1164.441","112":"707.4496","113":"134.6348","114":"1308.585","115":"672.7682","116":"279.3416","117":"689.9777","118":"58.05309","119":"745.8504","120":"331.4351","121":"631.9246","122":"121.4708","123":"46.06766","124":"8.077994","125":"1257.520","126":"218.1790","127":"1028.164","128":"380.2236","129":"1677.840","130":"285.0987","131":"5.044165","132":"459.4586","133":"64.007517","134":"720.4899","135":"99.07423","136":"719.1814","137":"152.02161","138":"12.00517","139":"0","140":"63.05027","141":"19.00423","142":"69.0747","143":"0.00000000","144":"15020.69","145":"830.9759","146":"734.57837","147":"651.8974","148":"410.5272","149":"830.9759","150":"552.5812","151":"25995.34","152":"27911.59","153":"22426.73","154":"2555.351","155":"54998.67","156":"70168.17","157":"457.3353","158":"649.8997","159":"335.7564","160":"259.07987","161":"11.01644","162":"15.03853","163":"1","164":"0","_rn_":"1"},{"1":"3.6001e+10","2":"4731","3":"NY","4":"Albany County","5":"Census Tract 2","6":"6046","7":"699","8":"4597","9":"15","10":"65","11":"648","12":"0","13":"13","14":"17","15":"4","16":"4","17":"3","18":"20","19":"21","20":"457","21":"14","22":"1388","23":"737","24":"3103","25":"589","26":"2514","27":"426","28":"2088","29":"1946","30":"608","31":"164","32":"699","33":"70","34":"100","35":"4455","36":"1329","37":"457","38":"648","39":"250","40":"27","41":"54","42":"5","43":"12","44":"11","45":"2","46":"3","47":"wbh","48":"Semi global","49":"0.6229098","50":"35733","51":"10580","52":"1","53":"5491.000","54":"705.0000","55":"4242.0000","56":"5.000000","57":"116.00000","58":"401.00000","59":"0.000000","60":"6.000000","61":"27.000000","62":"5.0000000","63":"9.000000","64":"12.000000","65":"64.000000","66":"9.000000","67":"266.00000","68":"21.000000000","69":"2914.0000","70":"639.00000","71":"2275.0000","72":"1900.0000","73":"663.0000","74":"284.0000","75":"705.0000","76":"42.0000","77":"227.0000","78":"4084.0000","79":"1407.00000","80":"394.00000","81":"401.00000","82":"182.00000","83":"14.000000","84":"4.000000","85":"1.000000000","86":"1.000000000","87":"111.00000","88":"27.00000","89":"10.000000","90":"1264.0000","91":"710.00000","92":"475.0000","93":"1800.0000","94":"5491.000","95":"6.000000","96":"155.00000","97":"63.00000","98":"175.0000","99":"15.000000","100":"0.00000000","101":"0.000000","102":"10.00000000","103":"0.000000","104":"0","105":"593.0000","106":"340.0000","107":"197.000000","108":"4907.000","109":"585.0000","110":"126.00000","111":"3041.000","112":"1779.0000","113":"384.0000","114":"3870.000","115":"774.0000","116":"1159.0000","117":"2132.0000","118":"221.00000","119":"2103.0000","120":"1167.0000","121":"1911.0000","122":"473.0000","123":"100.00000","124":"90.000000","125":"3595.000","126":"327.0000","127":"3160.000","128":"1045.0000","129":"5353.000","130":"1864.0000","131":"103.000000","132":"1250.0000","133":"384.000000","134":"591.0000","135":"93.00000","136":"4173.0000","137":"1586.00000","138":"0.00000","139":"0","140":"386.00000","141":"183.00000","142":"156.0000","143":"0.00000000","144":"12147.00","145":"2914.0000","146":"1911.00000","147":"2275.0000","148":"1705.0000","149":"2914.0000","150":"2416.0000","151":"16222.00","152":"37798.00","153":"14659.00","154":"11036.000","155":"24791.67","156":"75100.00","157":"390.0000","158":"2262.0000","159":"335.0000","160":"1679.00000","161":"167.00000","162":"41.00000","163":"1","164":"0","_rn_":"2"},{"1":"3.6001e+10","2":"5558","3":"NY","4":"Albany County","5":"Census Tract 3","6":"5888","7":"2740","8":"2252","9":"26","10":"232","11":"615","12":"0","13":"86","14":"30","15":"34","16":"7","17":"21","18":"14","19":"65","20":"337","21":"18","22":"1294","23":"378","24":"3041","25":"460","26":"2581","27":"893","28":"1688","29":"1297","30":"1159","31":"489","32":"2740","33":"231","34":"845","35":"2077","36":"561","37":"243","38":"615","39":"224","40":"41","41":"212","42":"45","43":"16","44":"11","45":"0","46":"2","47":"wbha","48":"Global","49":"0.7317972","50":"35734","51":"10580","52":"1","53":"5578.812","54":"3068.0581","55":"1981.5187","56":"14.033496","57":"174.78351","58":"320.39702","59":"0.999902","60":"62.198346","61":"37.144767","62":"2.1250949","63":"3.037510","64":"23.145782","65":"23.019772","66":"32.074264","67":"183.98378","68":"8.030991100","69":"2591.0189","70":"208.16437","71":"2382.8546","72":"1445.9099","73":"1103.0751","74":"455.4494","75":"3068.0581","76":"408.8211","77":"910.0272","78":"1904.5525","79":"668.44035","80":"157.92367","81":"320.39702","82":"129.07201","83":"23.027413","84":"7.005953","85":"2.998488216","86":"0.002198024","87":"152.70108","88":"34.14898","89":"9.081699","90":"1290.1468","91":"391.01233","92":"936.6261","93":"1446.2285","94":"5578.984","95":"29.350470","96":"573.01580","97":"340.13015","98":"836.0874","99":"21.242979","100":"0.03649049","101":"54.102603","102":"0.07212608","103":"7.100123","104":"0","105":"724.0948","106":"259.0009","107":"396.049374","108":"5139.925","109":"736.8433","110":"101.09828","111":"3643.387","112":"2012.4336","113":"667.6931","114":"4298.252","115":"1726.7831","116":"1048.5787","117":"2457.9032","118":"124.55055","119":"2321.6809","120":"1232.5049","121":"2333.3527","122":"777.0799","123":"131.30122","124":"128.718710","125":"4109.631","126":"530.4656","127":"3338.939","128":"806.5713","129":"5357.667","130":"1280.7471","131":"68.090235","132":"1311.9367","133":"241.909885","134":"2973.1941","135":"430.28965","136":"1903.3658","137":"770.27606","138":"0.00000","139":"0","140":"300.67533","141":"152.02748","142":"148.2810","143":"0.07017401","144":"21639.53","145":"2591.0713","146":"1936.12402","147":"2382.9145","148":"1656.5091","149":"2591.0713","150":"1728.7407","151":"31024.42","152":"35085.24","153":"23751.61","154":"13913.926","155":"52306.21","156":"88784.18","157":"498.1364","158":"2376.6354","159":"1518.9647","160":"730.36146","161":"69.11037","162":"39.10999","163":"1","164":"0","_rn_":"3"},{"1":"3.6001e+10","2":"2459","3":"NY","4":"Albany County","5":"Census Tract 4.01","6":"2227","7":"1896","8":"207","9":"7","10":"61","11":"53","12":"0","13":"20","14":"30","15":"5","16":"1","17":"1","18":"1","19":"2","20":"26","21":"9","22":"377","23":"24","24":"1074","25":"57","26":"1017","27":"628","28":"389","29":"149","30":"1241","31":"884","32":"1896","33":"67","34":"1156","35":"198","36":"44","37":"61","38":"53","39":"10","40":"7","41":"56","42":"3","43":"15","44":"2","45":"0","46":"0","47":"wba","48":"Semi global","49":"0.3237656","50":"35735","51":"10580","52":"0","53":"2122.269","54":"1829.9204","55":"149.6663","56":"8.979980","57":"69.84429","58":"60.86431","59":"0.000000","60":"12.971083","61":"32.926594","62":"0.9977756","63":"3.991102","64":"6.984429","65":"6.984429","66":"1.995551","67":"33.92437","68":"5.986653328","69":"848.1092","70":"18.95774","71":"829.1515","72":"190.5751","73":"929.9268","74":"711.4139","75":"1829.9204","76":"112.7486","77":"886.0247","78":"143.6797","79":"30.93104","80":"24.94439","81":"60.86431","82":"18.95774","83":"8.979980","84":"3.991102","85":"0.000000000","86":"2.993326664","87":"61.86208","88":"8.97998","89":"3.991102","90":"358.2014","91":"27.93772","92":"555.7610","93":"273.3905","94":"2111.293","95":"5.986653","96":"279.37717","97":"170.61961","98":"270.3972","99":"21.951061","100":"0.00000000","101":"12.971083","102":"12.97108269","103":"0.000000","104":"0","105":"140.6864","106":"113.7464","107":"6.984429","108":"2064.398","109":"320.2859","110":"31.92882","111":"1842.891","112":"723.3873","113":"685.4718","114":"1951.649","115":"785.2494","116":"596.6698","117":"958.8623","118":"30.93104","119":"1285.1349","120":"545.7832","121":"927.9313","122":"523.8322","123":"22.94884","124":"49.888779","125":"1919.720","126":"203.5462","127":"1080.591","128":"240.4639","129":"1548.548","130":"113.7464","131":"28.935492","132":"331.2615","133":"9.977756","134":"1241.2328","135":"57.87098","136":"157.6485","137":"11.97331","138":"0.00000","139":"0","140":"74.83317","141":"24.94439","142":"40.9088","143":"4.98887777","144":"25915.00","145":"842.1226","146":"35.91992","147":"823.1649","148":"572.7231","149":"842.1226","150":"356.2059","151":"51214.00","152":"50571.00","153":"39375.00","154":"33750.001","155":"61500.00","156":"85400.00","157":"767.0000","158":"830.1493","159":"694.4518","160":"64.85541","161":"29.93327","162":"24.94439","163":"0","164":"1","_rn_":"4"},{"1":"3.6001e+10","2":"4695","3":"NY","4":"Albany County","5":"Census Tract 4.03","6":"4415","7":"3275","8":"450","9":"10","10":"470","11":"201","12":"0","13":"61","14":"284","15":"14","16":"7","17":"46","18":"12","19":"15","20":"95","21":"7","22":"962","23":"85","24":"2306","25":"110","26":"2196","27":"1164","28":"1032","29":"531","30":"944","31":"349","32":"3275","33":"303","34":"855","35":"407","36":"71","37":"45","38":"201","39":"38","40":"21","41":"444","42":"41","43":"17","44":"5","45":"0","46":"1","47":"wba","48":"Semi global","49":"0.6181698","50":"35736","51":"10580","52":"0","53":"4411.000","54":"3720.0000","55":"352.0000","56":"10.000000","57":"192.00000","58":"124.00000","59":"0.000000","60":"20.000000","61":"104.000000","62":"6.0000000","63":"8.000000","64":"38.000000","65":"6.000000","66":"16.000000","67":"48.00000","68":"17.000000000","69":"2266.0000","70":"76.00000","71":"2190.0000","72":"685.0000","73":"1064.0000","74":"485.0000","75":"3720.0000","76":"439.0000","77":"1018.0000","78":"300.0000","79":"84.00000","80":"28.00000","81":"124.00000","82":"27.00000","83":"5.000000","84":"7.000000","85":"1.000000000","86":"0.000000000","87":"172.00000","88":"22.00000","89":"4.000000","90":"1042.0000","91":"97.00000","92":"1167.0000","93":"1023.0000","94":"4411.000","95":"100.000000","96":"682.00000","97":"373.00000","98":"995.0000","99":"24.000000","100":"21.00000000","101":"17.000000","102":"7.00000000","103":"13.000000","104":"0","105":"344.0000","106":"160.0000","107":"202.000000","108":"4174.000","109":"460.0000","110":"40.00000","111":"3363.000","112":"948.0000","113":"1676.0000","114":"3815.000","115":"1689.0000","116":"769.0000","117":"2427.0000","118":"65.00000","119":"2114.0000","120":"1234.0000","121":"2362.0000","122":"1441.0000","123":"70.00000","124":"156.000000","125":"3734.000","126":"396.0000","127":"2940.000","128":"336.0000","129":"4402.000","130":"331.0000","131":"15.000000","132":"1063.0000","133":"15.000000","134":"3689.0000","135":"210.00000","136":"289.0000","137":"25.00000","138":"0.00000","139":"0","140":"106.00000","141":"0.00000","142":"175.0000","143":"83.00000000","144":"26415.00","145":"2266.0000","146":"2101.00000","147":"2190.0000","148":"1414.0000","149":"2266.0000","150":"1102.0000","151":"40040.00","152":"40565.00","153":"39231.00","154":"32011.000","155":"14687.50","156":"109500.00","157":"607.0000","158":"2213.0000","159":"1961.0000","160":"96.00000","161":"37.00000","162":"71.00000","163":"0","164":"1","_rn_":"5"},{"1":"3.6001e+10","2":"5090","3":"NY","4":"Albany County","5":"Census Tract 4.04","6":"5203","7":"3327","8":"764","9":"21","10":"426","11":"647","12":"2","13":"102","14":"154","15":"28","16":"23","17":"73","18":"6","19":"23","20":"207","21":"17","22":"6","23":"1","24":"13","25":"1","26":"12","27":"12","28":"0","29":"10","30":"6","31":"5","32":"3327","33":"2","34":"1","35":"707","36":"1","37":"4","38":"647","39":"0","40":"0","41":"381","42":"0","43":"0","44":"10","45":"0","46":"1","47":"wbha","48":"Global","49":"0.6701777","50":"35737","51":"10580","52":"0","53":"4922.000","54":"3328.0000","55":"645.0000","56":"12.000000","57":"535.00000","58":"378.00000","59":"0.000000","60":"129.000000","61":"227.000000","62":"30.0000000","63":"17.000000","64":"97.000000","65":"7.000000","66":"26.000000","67":"136.00000","68":"3.000000000","69":"22.0000","70":"0.00000","71":"22.0000","72":"27.0000","73":"13.0000","74":"3.0000","75":"3328.0000","76":"3.0000","77":"7.0000","78":"622.0000","79":"0.00000","80":"6.00000","81":"378.00000","82":"0.00000","83":"0.000000","84":"4.000000","85":"0.000000000","86":"0.000000000","87":"498.00000","88":"0.00000","89":"0.000000","90":"8.0000","91":"1.00000","92":"13.0000","93":"9.0000","94":"4922.000","95":"130.000000","96":"462.00000","97":"169.00000","98":"348.0000","99":"7.000000","100":"14.00000000","101":"8.000000","102":"0.00000000","103":"0.000000","104":"0","105":"306.0000","106":"126.0000","107":"102.000000","108":"4922.000","109":"1006.0000","110":"34.00000","111":"50.000","112":"28.0000","113":"16.0000","114":"4913.000","115":"2853.0000","116":"368.0000","117":"3812.0000","118":"2630.00000","119":"2428.0000","120":"1864.0000","121":"1182.0000","122":"231.0000","123":"7.00000","124":"37.000000","125":"4898.000","126":"22.0000","127":"4897.000","128":"340.0000","129":"51.000","130":"17.0000","131":"0.000000","132":"9.0000","133":"0.000000","134":"35.0000","135":"17.00000","136":"16.0000","137":"0.00000","138":"0.00000","139":"0","140":"0.00000","141":"0.00000","142":"0.0000","143":"0.00000000","144":"3809.00","145":"22.0000","146":"15.00000","147":"22.0000","148":"15.0000","149":"22.0000","150":"7.0000","151":"58611.00","152":"35000.00","153":"102264.00","154":"44199.626","155":"59227.88","156":"99400.00","157":"525.0000","158":"26.0000","159":"18.0000","160":"8.00000","161":"0.00000","162":"0.00000","163":"0","164":"1","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="step-03" class="section level2">
<h2>STEP 03</h2>
<p>Match the “treated” census tracts (those that received federal aid) with <em>equivalent</em> untreated tracts using the matchit package.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>match_tracts &lt;-<span class="st"> </span><span class="cf">function</span>( fo, dorling.object )</span>
<span id="cb11-2"><a href="#cb11-2"></a>{</span>
<span id="cb11-3"><a href="#cb11-3"></a>   <span class="co"># extract data frame from sp object</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>   <span class="co"># rename rows using tract IDs</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>   </span>
<span id="cb11-6"><a href="#cb11-6"></a>   df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>( dorling.object )</span>
<span id="cb11-7"><a href="#cb11-7"></a>   <span class="kw">row.names</span>(df) &lt;-<span class="st"> </span>df<span class="op">$</span>GEOID</span>
<span id="cb11-8"><a href="#cb11-8"></a>   </span>
<span id="cb11-9"><a href="#cb11-9"></a>   <span class="co"># convert string to formula object</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>   fo &lt;-<span class="st"> </span><span class="kw">as.formula</span>( fo )</span>
<span id="cb11-11"><a href="#cb11-11"></a>   </span>
<span id="cb11-12"><a href="#cb11-12"></a>   matchit.object &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb11-13"><a href="#cb11-13"></a></span>
<span id="cb11-14"><a href="#cb11-14"></a>   <span class="co"># find matches in dataframe based on Household income, college education, and whiteness </span></span>
<span id="cb11-15"><a href="#cb11-15"></a>   <span class="kw">try</span>( </span>
<span id="cb11-16"><a href="#cb11-16"></a>      <span class="kw">invisible</span>({ <span class="kw">capture.output</span>({ </span>
<span id="cb11-17"><a href="#cb11-17"></a>         </span>
<span id="cb11-18"><a href="#cb11-18"></a>      matchit.object &lt;-<span class="st"> </span><span class="kw">matchit</span>( fo, </span>
<span id="cb11-19"><a href="#cb11-19"></a>                        <span class="dt">method=</span><span class="st">&quot;genetic&quot;</span>, <span class="dt">discard=</span><span class="st">&quot;both&quot;</span>, <span class="dt">reestimate=</span><span class="ot">TRUE</span>,</span>
<span id="cb11-20"><a href="#cb11-20"></a>                        <span class="dt">replace=</span><span class="ot">FALSE</span>, <span class="dt">caliper=</span>.<span class="dv">25</span>, <span class="dt">data =</span> df )</span>
<span id="cb11-21"><a href="#cb11-21"></a>      })  })</span>
<span id="cb11-22"><a href="#cb11-22"></a>   )</span>
<span id="cb11-23"><a href="#cb11-23"></a></span>
<span id="cb11-24"><a href="#cb11-24"></a>   <span class="kw">return</span>( matchit.object )</span>
<span id="cb11-25"><a href="#cb11-25"></a></span>
<span id="cb11-26"><a href="#cb11-26"></a>}</span></code></pre></div>
<p>Test the function:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># define the matching function formula </span></span>
<span id="cb12-2"><a href="#cb12-2"></a>fo &lt;-<span class="st"> </span><span class="kw">as.formula</span>( <span class="st">&quot;treatment ~ own00&quot;</span> )</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a>new.orleans.matches &lt;-<span class="st"> </span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="st">   </span><span class="kw">match_tracts</span>( fo, new.orleans ) </span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="kw">summary</span>( new.orleans.matches )</span></code></pre></div>
<pre><code>## 
## Call:
## matchit(formula = fo, data = df, method = &quot;genetic&quot;, discard = &quot;both&quot;, 
##     reestimate = TRUE, replace = FALSE, caliper = 0.25)
## 
## Summary of balance for all data:
##          Means Treated Means Control SD Control Mean Diff  eQQ Med eQQ Mean
## distance        0.1365          0.05     0.0610    0.0865   0.0865   0.0794
## own00         410.7383       1006.03   548.5253 -595.2918 495.6152 625.1273
##           eQQ Max
## distance    0.134
## own00    1533.710
## 
## 
## Summary of balance for matched data:
##          Means Treated Means Control SD Control Mean Diff eQQ Med eQQ Mean
## distance        0.1233        0.1227     0.0756    0.0006  0.0005   0.0017
## own00         447.4121      448.1433   270.3945   -0.7312  2.2412   4.8797
##          eQQ Max
## distance  0.0087
## own00    19.0000
## 
## Percent Balance Improvement:
##          Mean Diff. eQQ Med eQQ Mean eQQ Max
## distance    99.3560 99.4740  97.9053 93.4945
## own00       99.8772 99.5478  99.2194 98.7612
## 
## Sample sizes:
##           Control Treated
## All           207      11
## Matched        10      10
## Unmatched      98       1
## Discarded      99       0</code></pre>
</div>
<div id="step-04" class="section level2">
<h2>STEP 04</h2>
<div id="assign-tracts-to-groups" class="section level3">
<h3>Assign tracts to groups</h3>
<p>Treated or untreated tracts by Matched or unmatched tracts</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>assign_groups &lt;-<span class="st">  </span><span class="cf">function</span>( matchit.object, dorling.object )</span>
<span id="cb14-2"><a href="#cb14-2"></a>{</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="cf">if</span>( <span class="kw">is.null</span>( matchit.object ) )</span>
<span id="cb14-5"><a href="#cb14-5"></a>  { </span>
<span id="cb14-6"><a href="#cb14-6"></a>     status &lt;-<span class="st"> </span><span class="kw">rep</span>( <span class="st">&quot;control.unmatched&quot;</span>, <span class="kw">nrow</span>( dorling.object ) )</span>
<span id="cb14-7"><a href="#cb14-7"></a>     status[ dorling.object<span class="op">$</span>treatment <span class="op">==</span><span class="st"> </span><span class="dv">1</span> ] &lt;-<span class="st"> &quot;treatment.unmatched&quot;</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>     dorling.object<span class="op">$</span>status &lt;-<span class="st"> </span>status</span>
<span id="cb14-9"><a href="#cb14-9"></a>  }</span>
<span id="cb14-10"><a href="#cb14-10"></a>   </span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="cf">if</span>( <span class="op">!</span><span class="st"> </span><span class="kw">is.null</span>( matchit.object ) )  </span>
<span id="cb14-12"><a href="#cb14-12"></a>  {</span>
<span id="cb14-13"><a href="#cb14-13"></a></span>
<span id="cb14-14"><a href="#cb14-14"></a>     <span class="co"># extract matched pairs from matchit object</span></span>
<span id="cb14-15"><a href="#cb14-15"></a>     <span class="co"># match matrix is the length of the original treated groups</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>     <span class="co"># IDs are rows of the original dataset</span></span>
<span id="cb14-17"><a href="#cb14-17"></a>     </span>
<span id="cb14-18"><a href="#cb14-18"></a>     matches &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">treatment.group.id=</span><span class="kw">row.names</span>( matchit.object<span class="op">$</span>match.matrix), </span>
<span id="cb14-19"><a href="#cb14-19"></a>                            <span class="dt">control.group.id=</span>matchit.object<span class="op">$</span>match.matrix )</span>
<span id="cb14-20"><a href="#cb14-20"></a>   </span>
<span id="cb14-21"><a href="#cb14-21"></a>     these.na &lt;-<span class="st"> </span><span class="kw">is.na</span>( matches<span class="op">$</span>control.group.id )</span>
<span id="cb14-22"><a href="#cb14-22"></a>   </span>
<span id="cb14-23"><a href="#cb14-23"></a>     <span class="co"># generate four cases for tracts </span></span>
<span id="cb14-24"><a href="#cb14-24"></a>     id.all.treated &lt;-<span class="st"> </span>matches<span class="op">$</span>treatment.group.id </span>
<span id="cb14-25"><a href="#cb14-25"></a>     id.treated.matched &lt;-<span class="st"> </span>matches<span class="op">$</span>treatment.group.id[ <span class="op">!</span><span class="st"> </span>these.na ]</span>
<span id="cb14-26"><a href="#cb14-26"></a>     id.treated.unmatched &lt;-<span class="st"> </span>matches<span class="op">$</span>treatment.group.id[ these.na ]</span>
<span id="cb14-27"><a href="#cb14-27"></a>     id.control.matched &lt;-<span class="st"> </span><span class="kw">na.omit</span>(matches<span class="op">$</span>control.group.id)</span>
<span id="cb14-28"><a href="#cb14-28"></a>     id.control.unmatched &lt;-<span class="st"> </span>dorling.object<span class="op">$</span>GEOID [ <span class="op">!</span>( dorling.object<span class="op">$</span>GEOID <span class="op">%in%</span><span class="st"> </span>id.all.treated <span class="op">|</span><span class="st"> </span></span>
<span id="cb14-29"><a href="#cb14-29"></a><span class="st">                                                    </span>dorling.object<span class="op">$</span>GEOID <span class="op">%in%</span><span class="st"> </span>id.control.matched ) ]</span>
<span id="cb14-30"><a href="#cb14-30"></a>   </span>
<span id="cb14-31"><a href="#cb14-31"></a>     <span class="co">### Assign tract IDs to groups</span></span>
<span id="cb14-32"><a href="#cb14-32"></a>     </span>
<span id="cb14-33"><a href="#cb14-33"></a>     treated.matched &lt;-<span class="st"> </span><span class="kw">na.omit</span>(id.treated.matched) <span class="op">%&gt;%</span><span class="st"> </span>as.numeric</span>
<span id="cb14-34"><a href="#cb14-34"></a>     control.matched &lt;-<span class="st"> </span><span class="kw">na.omit</span>(id.control.matched) <span class="op">%&gt;%</span><span class="st"> </span>as.numeric</span>
<span id="cb14-35"><a href="#cb14-35"></a>     </span>
<span id="cb14-36"><a href="#cb14-36"></a>     treated.unmatched &lt;-<span class="st"> </span><span class="kw">na.omit</span>(id.treated.unmatched)  <span class="op">%&gt;%</span><span class="st"> </span>as.numeric</span>
<span id="cb14-37"><a href="#cb14-37"></a>     control.unmatched &lt;-<span class="st"> </span><span class="kw">na.omit</span>(id.control.unmatched)  <span class="op">%&gt;%</span><span class="st"> </span>as.numeric</span>
<span id="cb14-38"><a href="#cb14-38"></a>     </span>
<span id="cb14-39"><a href="#cb14-39"></a>     status &lt;-<span class="st"> </span><span class="kw">rep</span>( <span class="st">&quot;control.unmatched&quot;</span>, <span class="kw">nrow</span>( dorling.object ) )</span>
<span id="cb14-40"><a href="#cb14-40"></a>     status[ dorling.object<span class="op">$</span>GEOID <span class="op">%in%</span><span class="st"> </span>control.matched ] &lt;-<span class="st"> &quot;control.matched&quot;</span></span>
<span id="cb14-41"><a href="#cb14-41"></a>     status[ dorling.object<span class="op">$</span>GEOID <span class="op">%in%</span><span class="st"> </span>treated.matched ] &lt;-<span class="st"> &quot;treatment.matched&quot;</span></span>
<span id="cb14-42"><a href="#cb14-42"></a>     status[ dorling.object<span class="op">$</span>GEOID <span class="op">%in%</span><span class="st"> </span>treated.unmatched ] &lt;-<span class="st"> &quot;treatment.unmatched&quot;</span></span>
<span id="cb14-43"><a href="#cb14-43"></a>     dorling.object<span class="op">$</span>status &lt;-<span class="st"> </span>status</span>
<span id="cb14-44"><a href="#cb14-44"></a>      </span>
<span id="cb14-45"><a href="#cb14-45"></a>  }</span>
<span id="cb14-46"><a href="#cb14-46"></a>   </span>
<span id="cb14-47"><a href="#cb14-47"></a>  <span class="kw">return</span>( dorling.object )</span>
<span id="cb14-48"><a href="#cb14-48"></a></span>
<span id="cb14-49"><a href="#cb14-49"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>new.orleans &lt;-<span class="st"> </span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="st">   </span><span class="kw">assign_groups</span>( <span class="dt">matchit.object=</span>new.orleans.matches, </span>
<span id="cb15-3"><a href="#cb15-3"></a>                  <span class="dt">dorling.object=</span>new.orleans )</span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="kw">table</span>( new.orleans<span class="op">$</span>status )</span></code></pre></div>
<pre><code>## 
##     control.matched   control.unmatched   treatment.matched treatment.unmatched 
##                  10                 197                  10                   1</code></pre>
</div>
</div>
<div id="step-05---map-matches" class="section level1">
<h1>STEP 05 - Map Matches</h1>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>map_matches &lt;-<span class="st"> </span><span class="cf">function</span>( dorling.object, cbsa.name, <span class="dt">zoom=</span><span class="ot">TRUE</span>, <span class="dt">zoom.range=</span><span class="dv">90</span> )</span>
<span id="cb17-2"><a href="#cb17-2"></a>{</span>
<span id="cb17-3"><a href="#cb17-3"></a></span>
<span id="cb17-4"><a href="#cb17-4"></a>   </span>
<span id="cb17-5"><a href="#cb17-5"></a>   <span class="cf">if</span>( <span class="kw">sum</span>( dorling.object<span class="op">$</span>status <span class="op">==</span><span class="st"> &quot;treatment.matched&quot;</span> ) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> )</span>
<span id="cb17-6"><a href="#cb17-6"></a>   {</span>
<span id="cb17-7"><a href="#cb17-7"></a>      </span>
<span id="cb17-8"><a href="#cb17-8"></a>   <span class="co">### Create color vectors based on matches</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>   </span>
<span id="cb17-10"><a href="#cb17-10"></a>   color.vector &lt;-<span class="st"> </span><span class="kw">rep</span>( <span class="st">&quot;gray80&quot;</span>, <span class="kw">nrow</span>( dorling.object ) )</span>
<span id="cb17-11"><a href="#cb17-11"></a>   color.vector[ dorling.object<span class="op">$</span>status <span class="op">==</span><span class="st"> &quot;control.matched&quot;</span> ] &lt;-<span class="st"> &quot;blue&quot;</span></span>
<span id="cb17-12"><a href="#cb17-12"></a>   color.vector[ dorling.object<span class="op">$</span>status <span class="op">==</span><span class="st"> &quot;treatment.matched&quot;</span> ] &lt;-<span class="st"> &quot;darkred&quot;</span></span>
<span id="cb17-13"><a href="#cb17-13"></a>   color.vector[ dorling.object<span class="op">$</span>status <span class="op">==</span><span class="st"> &quot;treatment.unmatched&quot;</span> ] &lt;-<span class="st"> </span><span class="kw">adjustcolor</span>( <span class="st">&quot;darkred&quot;</span>, <span class="dt">alpha.f =</span> <span class="fl">0.4</span> )</span>
<span id="cb17-14"><a href="#cb17-14"></a>   </span>
<span id="cb17-15"><a href="#cb17-15"></a>   border.color &lt;-<span class="st"> </span><span class="kw">rep</span>( <span class="st">&quot;gray40&quot;</span>, <span class="kw">nrow</span>(dorling.object) )</span>
<span id="cb17-16"><a href="#cb17-16"></a>   border.color[ dorling.object<span class="op">$</span>status <span class="op">==</span><span class="st"> &quot;treatment.unmatched&quot;</span> ] &lt;-<span class="st"> &quot;darkred&quot;</span></span>
<span id="cb17-17"><a href="#cb17-17"></a>   </span>
<span id="cb17-18"><a href="#cb17-18"></a>   </span>
<span id="cb17-19"><a href="#cb17-19"></a>   <span class="co"># set zoom</span></span>
<span id="cb17-20"><a href="#cb17-20"></a>   </span>
<span id="cb17-21"><a href="#cb17-21"></a>   coords &lt;-<span class="st"> </span><span class="kw">coordinates</span>( dorling.object ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>()</span>
<span id="cb17-22"><a href="#cb17-22"></a>   </span>
<span id="cb17-23"><a href="#cb17-23"></a>   x.min.max &lt;-<span class="st"> </span><span class="kw">range</span>( coords<span class="op">$</span>V1, <span class="dt">na.rm=</span>T )</span>
<span id="cb17-24"><a href="#cb17-24"></a>   y.min.max &lt;-<span class="st"> </span><span class="kw">range</span>( coords<span class="op">$</span>V2, <span class="dt">na.rm=</span>T )</span>
<span id="cb17-25"><a href="#cb17-25"></a>   </span>
<span id="cb17-26"><a href="#cb17-26"></a>   <span class="cf">if</span>( zoom )</span>
<span id="cb17-27"><a href="#cb17-27"></a>   {</span>
<span id="cb17-28"><a href="#cb17-28"></a>     tail &lt;-<span class="st"> </span>( <span class="dv">100</span> <span class="op">-</span><span class="st"> </span>zoom.range ) <span class="op">/</span><span class="st"> </span><span class="dv">200</span>   </span>
<span id="cb17-29"><a href="#cb17-29"></a>     x.min.max &lt;-<span class="st"> </span><span class="kw">quantile</span>( coords<span class="op">$</span>V1, <span class="kw">c</span>( <span class="dv">0</span><span class="op">+</span>tail, <span class="dv">1</span><span class="op">-</span>tail ) )</span>
<span id="cb17-30"><a href="#cb17-30"></a>     y.min.max &lt;-<span class="st"> </span><span class="kw">quantile</span>( coords<span class="op">$</span>V2, <span class="kw">c</span>( <span class="dv">0</span><span class="op">+</span>tail, <span class="dv">1</span><span class="op">-</span>tail ) )</span>
<span id="cb17-31"><a href="#cb17-31"></a>   }</span>
<span id="cb17-32"><a href="#cb17-32"></a>   </span>
<span id="cb17-33"><a href="#cb17-33"></a>   <span class="kw">par</span>( <span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>) )</span>
<span id="cb17-34"><a href="#cb17-34"></a>   </span>
<span id="cb17-35"><a href="#cb17-35"></a>   <span class="kw">plot</span>( dorling.object, </span>
<span id="cb17-36"><a href="#cb17-36"></a>         <span class="dt">col=</span>color.vector, </span>
<span id="cb17-37"><a href="#cb17-37"></a>         <span class="dt">border=</span>border.color, </span>
<span id="cb17-38"><a href="#cb17-38"></a>         <span class="dt">xlim=</span>x.min.max,</span>
<span id="cb17-39"><a href="#cb17-39"></a>         <span class="dt">ylim=</span>y.min.max,</span>
<span id="cb17-40"><a href="#cb17-40"></a>         <span class="dt">main=</span><span class="kw">toupper</span>(cbsa.name), </span>
<span id="cb17-41"><a href="#cb17-41"></a>         <span class="dt">cex.main=</span><span class="fl">1.5</span> )</span>
<span id="cb17-42"><a href="#cb17-42"></a>   }</span>
<span id="cb17-43"><a href="#cb17-43"></a>   </span>
<span id="cb17-44"><a href="#cb17-44"></a>   <span class="cf">if</span>( <span class="kw">sum</span>( dorling.object<span class="op">$</span>status <span class="op">==</span><span class="st"> &quot;treatment.matched&quot;</span> ) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> )</span>
<span id="cb17-45"><a href="#cb17-45"></a>   {</span>
<span id="cb17-46"><a href="#cb17-46"></a>      <span class="kw">par</span>( <span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>) )</span>
<span id="cb17-47"><a href="#cb17-47"></a>      <span class="kw">plot</span>( dorling.object,</span>
<span id="cb17-48"><a href="#cb17-48"></a>            <span class="dt">col=</span><span class="kw">ifelse</span>( dorling.object<span class="op">$</span>treatment <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;darkred&quot;</span>, <span class="st">&quot;gray80&quot;</span> ),</span>
<span id="cb17-49"><a href="#cb17-49"></a>            <span class="dt">main=</span><span class="kw">paste0</span>( <span class="kw">toupper</span>(cbsa.name), <span class="st">&quot;: </span><span class="ch">\n</span><span class="st">NO VALID COUNTERFACTUALS FOUND&quot;</span> ), </span>
<span id="cb17-50"><a href="#cb17-50"></a>            <span class="dt">cex.main=</span><span class="fl">1.5</span> )</span>
<span id="cb17-51"><a href="#cb17-51"></a>            </span>
<span id="cb17-52"><a href="#cb17-52"></a>   }</span>
<span id="cb17-53"><a href="#cb17-53"></a>   </span>
<span id="cb17-54"><a href="#cb17-54"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">map_matches</span>( new.orleans, <span class="dt">cbsa.name=</span><span class="st">&quot;New Orleans&quot;</span>, <span class="dt">zoom=</span><span class="ot">TRUE</span>, <span class="dt">zoom.range=</span><span class="dv">90</span> )</span></code></pre></div>
<p><img src="metro-matching-loop-v2_files/figure-html/unnamed-chunk-14-1.png" width="960" /></p>
</div>
<div id="combine-steps" class="section level1">
<h1>Combine Steps</h1>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>get_matches &lt;-<span class="st"> </span><span class="cf">function</span>( cbsa.code, cbsa.catalog, </span>
<span id="cb19-2"><a href="#cb19-2"></a>                         df.treatment, fo,</span>
<span id="cb19-3"><a href="#cb19-3"></a>                         <span class="dt">zoom.range=</span><span class="dv">90</span>, <span class="dt">return.dorling=</span><span class="ot">FALSE</span> )</span>
<span id="cb19-4"><a href="#cb19-4"></a>{</span>
<span id="cb19-5"><a href="#cb19-5"></a>   </span>
<span id="cb19-6"><a href="#cb19-6"></a>   cbsa.name &lt;-<span class="st"> </span>cbsa.catalog<span class="op">$</span>cbsaname[ cbsa.catalog<span class="op">$</span>cbsa <span class="op">==</span><span class="st"> </span>cbsa.code ]</span>
<span id="cb19-7"><a href="#cb19-7"></a>   dorling.object &lt;-<span class="st"> </span><span class="kw">get_dorling</span>( <span class="dt">cbsa=</span>cbsa.code, cbsa.catalog )</span>
<span id="cb19-8"><a href="#cb19-8"></a>   dorling.object &lt;-<span class="st"> </span><span class="kw">add_treatment</span>( df.treatment, dorling.object )</span>
<span id="cb19-9"><a href="#cb19-9"></a>   matched.tracts &lt;-<span class="st"> </span><span class="kw">match_tracts</span>( <span class="dt">fo=</span>fo, dorling.object )</span>
<span id="cb19-10"><a href="#cb19-10"></a>   </span>
<span id="cb19-11"><a href="#cb19-11"></a>   <span class="cf">if</span>( <span class="op">!</span><span class="st"> </span><span class="kw">is.null</span>(matched.tracts) )</span>
<span id="cb19-12"><a href="#cb19-12"></a>   { </span>
<span id="cb19-13"><a href="#cb19-13"></a>      <span class="kw">cat</span>( <span class="kw">paste0</span>( <span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">&lt;h2&gt;&quot;</span>, <span class="kw">toupper</span>(cbsa.name), <span class="st">&quot;&lt;/h2&gt;&quot;</span>) )</span>
<span id="cb19-14"><a href="#cb19-14"></a>      <span class="kw">cat</span>( matched.tracts<span class="op">$</span>nn <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pander</span>() ) </span>
<span id="cb19-15"><a href="#cb19-15"></a>   }</span>
<span id="cb19-16"><a href="#cb19-16"></a>   </span>
<span id="cb19-17"><a href="#cb19-17"></a>   dorling.object &lt;-<span class="st"> </span><span class="kw">assign_groups</span>( matched.tracts, dorling.object )</span>
<span id="cb19-18"><a href="#cb19-18"></a>   <span class="kw">map_matches</span>( dorling.object, cbsa.name, <span class="dt">zoom=</span><span class="ot">TRUE</span>, zoom.range )</span>
<span id="cb19-19"><a href="#cb19-19"></a>   </span>
<span id="cb19-20"><a href="#cb19-20"></a>   <span class="cf">if</span>( return.dorling ){ <span class="kw">return</span>( dorling.object ) }</span>
<span id="cb19-21"><a href="#cb19-21"></a>   </span>
<span id="cb19-22"><a href="#cb19-22"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>fo &lt;-<span class="st"> </span><span class="kw">as.formula</span>( <span class="st">&quot;treatment ~ own00&quot;</span> )</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>akron &lt;-<span class="st"> </span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="st">   </span><span class="kw">get_matches</span>( <span class="dt">cbsa.code=</span><span class="dv">10420</span>, </span>
<span id="cb20-5"><a href="#cb20-5"></a>                <span class="dt">cbsa.catalog=</span>dorlings.catalog,</span>
<span id="cb20-6"><a href="#cb20-6"></a>                <span class="dt">df.treatment=</span>df.treatment,</span>
<span id="cb20-7"><a href="#cb20-7"></a>                <span class="dt">fo=</span>fo,</span>
<span id="cb20-8"><a href="#cb20-8"></a>                <span class="dt">return.dorling=</span><span class="ot">TRUE</span> )</span>
<span id="cb20-9"><a href="#cb20-9"></a></span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="kw">table</span>( akron<span class="op">$</span>status, <span class="dt">useNA=</span><span class="st">&quot;ifany&quot;</span> )</span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="kw">map_matches</span>( akron, <span class="dt">cbsa.name=</span><span class="st">&quot;AKRON, OH&quot;</span>, <span class="dt">zoom=</span><span class="ot">FALSE</span> )</span></code></pre></div>
<div id="create-loop-for-all-cbsas" class="section level2">
<h2>Create loop for all CBSAs</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># dorlings.catalog &lt;- load_crosswalk()</span></span>
<span id="cb21-2"><a href="#cb21-2"></a></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co"># df.treatment &lt;- # load treatment data </span></span>
<span id="cb21-4"><a href="#cb21-4"></a></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co"># matching formula </span></span>
<span id="cb21-6"><a href="#cb21-6"></a>fo &lt;-<span class="st"> </span><span class="kw">as.formula</span>( <span class="st">&quot;treatment ~ own00&quot;</span> )</span>
<span id="cb21-7"><a href="#cb21-7"></a>cbsa.code.list &lt;-<span class="st"> </span><span class="kw">unique</span>( dorlings.catalog<span class="op">$</span>cbsa )</span>
<span id="cb21-8"><a href="#cb21-8"></a></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="cf">for</span>( i <span class="cf">in</span> cbsa.code.list[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] )</span>
<span id="cb21-10"><a href="#cb21-10"></a>{</span>
<span id="cb21-11"><a href="#cb21-11"></a>  <span class="kw">get_matches</span>( <span class="dt">cbsa.code=</span>i, </span>
<span id="cb21-12"><a href="#cb21-12"></a>               <span class="dt">cbsa.catalog=</span>dorlings.catalog, </span>
<span id="cb21-13"><a href="#cb21-13"></a>               <span class="dt">df.treatment=</span>df.treatment, </span>
<span id="cb21-14"><a href="#cb21-14"></a>               <span class="dt">fo=</span>fo )</span>
<span id="cb21-15"><a href="#cb21-15"></a>}</span></code></pre></div>
<p>Error in weights.matrix(mm, treat, discarded) : No units were matched <img src="metro-matching-loop-v2_files/figure-html/unnamed-chunk-17-1.png" width="960" /></p>
<h2>
AKRON, OH
</h2>
<table style="width:50%;">
<colgroup>
<col width="22%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Control</th>
<th align="center">Treated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>All</strong></td>
<td align="center">166</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="center"><strong>Matched</strong></td>
<td align="center">4</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center"><strong>Unmatched</strong></td>
<td align="center">92</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center"><strong>Discarded</strong></td>
<td align="center">70</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p><img src="metro-matching-loop-v2_files/figure-html/unnamed-chunk-17-2.png" width="960" />Error in family$linkfun(mustart) : Argument mu must be a nonempty numeric vector <img src="metro-matching-loop-v2_files/figure-html/unnamed-chunk-17-3.png" width="960" /></p>
<h2>
ALBANY-SCHENECTADY-TROY, NY
</h2>
<table style="width:50%;">
<colgroup>
<col width="22%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Control</th>
<th align="center">Treated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>All</strong></td>
<td align="center">207</td>
<td align="center">11</td>
</tr>
<tr class="even">
<td align="center"><strong>Matched</strong></td>
<td align="center">10</td>
<td align="center">10</td>
</tr>
<tr class="odd">
<td align="center"><strong>Unmatched</strong></td>
<td align="center">98</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center"><strong>Discarded</strong></td>
<td align="center">99</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p><img src="metro-matching-loop-v2_files/figure-html/unnamed-chunk-17-4.png" width="960" /></p>
<h2>
ALBUQUERQUE, NM
</h2>
<table style="width:50%;">
<colgroup>
<col width="22%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Control</th>
<th align="center">Treated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>All</strong></td>
<td align="center">198</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="center"><strong>Matched</strong></td>
<td align="center">4</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center"><strong>Unmatched</strong></td>
<td align="center">181</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center"><strong>Discarded</strong></td>
<td align="center">13</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p><img src="metro-matching-loop-v2_files/figure-html/unnamed-chunk-17-5.png" width="960" /></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
